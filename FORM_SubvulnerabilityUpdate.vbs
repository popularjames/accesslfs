Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database

Private Sub Command40_Click()
Dim oAdo As clsADO
 
    Set oAdo = New clsADO
    With oAdo
        .ConnectionString = GetConnectString("v_Code_Database")
        .SQLTextType = StoredProc
        .sqlString = "USP_SubVulnerability"
        .Parameters.Refresh
        .Parameters("@RunType") = "v"
        .Parameters("@ErrMsg") = "''"
        .Execute
    End With
    Me.Requery
    SubVulnerabilityRAW_subFRM.Requery
    'Command41.Enabled = True
    
    Dim db As DAO.Database
    Dim rs As DAO.RecordSet
    Dim errcdvalid As Boolean
    errcdvalid = True
   
    Set db = CurrentDb
    SQL = "SELECT SubCode FROM SubVulnerabilityRAW WHERE icnverified = 'valid'" ' and AdrCheck = 'valid'"
    Set rs = db.OpenRecordSet(SQL, dbOpenSnapshot)
   
    If Not (rs.EOF Or rs.BOF) Then
     rs.MoveFirst
        While (Not rs.EOF)
        
            If (Nz(DLookup("recoveryreasonid", "xref_RecoveryReason", " errorcode = '" & rs.Fields("subcode").Value & "'"), "") = "") Then
                errcdvalid = False
                MsgBox ("subCode: ''" & rs.Fields("subcode").Value & "'' IS NOT VALID, please revise and re-validate")
                Command41.Enabled = False
            End If
            rs.MoveNext
        Wend
    Else
        errcdvalid = False
        MsgBox ("There seem to be NO valid ICN's that passed the ADR check... Please re-enter the claims, sub codes then try and re-validate")
        SubVulnerabilityRAW_subFRM.Requery
        Command41.BorderColor = RGB(200, 0, 0)
    
    End If
    
    If errcdvalid = True Then
        MsgBox ("Claims validated! Only claims with ICNVerified AND AdrCheck values = 'Valid' will be updated. All others will be removed.")
        Command41.Enabled = True
        Command41.BorderColor = RGB(0, 200, 0)
        SubVulnerabilityRAW_subFRM.Locked = True
    End If
    
    
End Sub

Private Sub Command41_Click()
Dim oAdo As clsADO

    Set oAdo = New clsADO
    With oAdo
        .ConnectionString = GetConnectString("v_Code_Database")
        .SQLTextType = sqltext
        .sqlString = "delete from cms_auditors_claims.dbo.SubVulnerabilityRAW where ICNVerified <> 'Valid' or adrcheck <> 'valid'"
        .Execute
    End With

    Set oAdo = New clsADO
    With oAdo
        .ConnectionString = GetConnectString("v_Code_Database")
        .SQLTextType = StoredProc
        .sqlString = "USP_SubVulnerability"
        .Parameters.Refresh
        .Parameters("@RunType") = "u"
        .Parameters("@ErrMsg") = "''"
        .Execute
    End With
    Me.Requery
    SubVulnerabilityRAW_subFRM.Requery
    MsgBox ("complete! Update has been run. Please make sure that all of the listed claims have been updated")
    Command41.Enabled = False
    
    

End Sub

Private Sub Command47_Click()
Dim oAdo As clsADO
    
    Set oAdo = New clsADO
    With oAdo
        .ConnectionString = GetConnectString("v_Code_Database")
        .SQLTextType = sqltext
        .sqlString = "delete from cms_auditors_claims.dbo.SubVulnerabilityRAW"
        .Execute
    End With
 
    SubVulnerabilityRAW_subFRM.Locked = False
    Me.Requery
    SubVulnerabilityRAW_subFRM.Requery
    Command41.Enabled = False
    Command41.BorderColor = RGB(200, 0, 0)
End Sub

Private Sub Form_Load()
Command47_Click
'MNG clear out all entries from the last run....
End Sub
